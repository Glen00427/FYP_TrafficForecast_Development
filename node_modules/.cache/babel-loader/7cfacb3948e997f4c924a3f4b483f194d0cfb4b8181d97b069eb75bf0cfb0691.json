{"ast":null,"code":"// components/UserSignInForm.jsx\nimport React,{useEffect,useState}from\"react\";import{supabase}from\"../lib/supabaseClient\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function UserSignInForm(_ref){let{open,onClose,onSuccess}=_ref;const[email,setEmail]=useState(\"\");const[password,setPassword]=useState(\"\");const[submitting,setSubmitting]=useState(false);const[err,setErr]=useState(\"\");useEffect(()=>{if(!open)return;setEmail(\"\");setPassword(\"\");setErr(\"\");const prev=document.body.style.overflow;document.body.style.overflow=\"hidden\";return()=>document.body.style.overflow=prev;},[open]);if(!open)return null;async function handleSubmit(e){e.preventDefault();setErr(\"\");setSubmitting(true);const emailNorm=(email||\"\").trim().toLowerCase();const pass=(password||\"\").trim();try{var _data$password,_ref2,_ref3,_data$id,_data$name,_data$email,_data$phone;const{data,error}=await supabase.from(\"users\").select(\"*\").ilike(\"email\",emailNorm).limit(1).maybeSingle();if(error){console.error(\"UserSignInForm SELECT error:\",error);setErr(\"Sign in failed. Please try again.\");return;}if(!data){setErr(\"No account found for that email.\");return;}if(String((_data$password=data.password)!==null&&_data$password!==void 0?_data$password:\"\").trim()!==pass){setErr(\"Incorrect email or password.\");return;}const uid=(_ref2=(_ref3=(_data$id=data.id)!==null&&_data$id!==void 0?_data$id:data.userid)!==null&&_ref3!==void 0?_ref3:data.user_id)!==null&&_ref2!==void 0?_ref2:\"local\";onSuccess===null||onSuccess===void 0?void 0:onSuccess({id:uid,name:(_data$name=data.name)!==null&&_data$name!==void 0?_data$name:\"\",email:(_data$email=data.email)!==null&&_data$email!==void 0?_data$email:emailNorm,role:\"user\",phone:(_data$phone=data.phone)!==null&&_data$phone!==void 0?_data$phone:\"\"});}catch(err){console.error(\"UserSignInForm exception:\",err);setErr(\"Sign in failed. Please try again.\");}finally{setSubmitting(false);}}return/*#__PURE__*/_jsx(\"div\",{className:\"usf-backdrop\",onClick:e=>e.target===e.currentTarget&&(onClose===null||onClose===void 0?void 0:onClose()),children:/*#__PURE__*/_jsxs(\"div\",{className:\"usf-card\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"button\",{className:\"usf-close\",\"aria-label\":\"Close\",onClick:onClose,children:\"\\u2715\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"usf-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"usf-ico\",children:\"\\uD83D\\uDD10\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"usf-title\",children:\"Sign In\"})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"usf-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"label\",{className:\"usf-label\",htmlFor:\"login-email\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{id:\"login-email\",className:\"usf-input\",type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true}),/*#__PURE__*/_jsx(\"label\",{className:\"usf-label\",htmlFor:\"login-pass\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{id:\"login-pass\",className:\"usf-input\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true}),err&&/*#__PURE__*/_jsx(\"div\",{className:\"usf-error\",children:err}),/*#__PURE__*/_jsx(\"button\",{className:\"usf-btn usf-btn-primary\",disabled:submitting,children:submitting?\"Signing in‚Ä¶\":\"Sign In\"})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","supabase","jsx","_jsx","jsxs","_jsxs","UserSignInForm","_ref","open","onClose","onSuccess","email","setEmail","password","setPassword","submitting","setSubmitting","err","setErr","prev","document","body","style","overflow","handleSubmit","e","preventDefault","emailNorm","trim","toLowerCase","pass","_data$password","_ref2","_ref3","_data$id","_data$name","_data$email","_data$phone","data","error","from","select","ilike","limit","maybeSingle","console","String","uid","id","userid","user_id","name","role","phone","className","onClick","target","currentTarget","children","stopPropagation","onSubmit","htmlFor","type","value","onChange","required","disabled"],"sources":["/workspaces/FYP_TrafficForecast/src/components/UserSignInForm.js"],"sourcesContent":["// components/UserSignInForm.jsx\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../lib/supabaseClient\";\n\nexport default function UserSignInForm({ open, onClose, onSuccess }) {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [submitting, setSubmitting] = useState(false);\n  const [err, setErr] = useState(\"\");\n\n  useEffect(() => {\n    if (!open) return;\n    setEmail(\"\");\n    setPassword(\"\");\n    setErr(\"\");\n    const prev = document.body.style.overflow;\n    document.body.style.overflow = \"hidden\";\n    return () => (document.body.style.overflow = prev);\n  }, [open]);\n\n  if (!open) return null;\n\n  async function handleSubmit(e) {\n    e.preventDefault();\n    setErr(\"\");\n    setSubmitting(true);\n\n    const emailNorm = (email || \"\").trim().toLowerCase();\n    const pass = (password || \"\").trim();\n\n    try {\n      const { data, error } = await supabase\n        .from(\"users\")\n        .select(\"*\")\n        .ilike(\"email\", emailNorm)\n        .limit(1)\n        .maybeSingle();\n\n      if (error) {\n        console.error(\"UserSignInForm SELECT error:\", error);\n        setErr(\"Sign in failed. Please try again.\");\n        return;\n      }\n      if (!data) {\n        setErr(\"No account found for that email.\");\n        return;\n      }\n      if (String(data.password ?? \"\").trim() !== pass) {\n        setErr(\"Incorrect email or password.\");\n        return;\n      }\n\n      const uid = data.id ?? data.userid ?? data.user_id ?? \"local\";\n\n      onSuccess?.({\n        id: uid,\n        name: data.name ?? \"\",\n        email: data.email ?? emailNorm,\n        role: \"user\",\n        phone: data.phone ?? \"\",\n      });\n    } catch (err) {\n      console.error(\"UserSignInForm exception:\", err);\n      setErr(\"Sign in failed. Please try again.\");\n    } finally {\n      setSubmitting(false);\n    }\n  }\n\n  return (\n    <div\n      className=\"usf-backdrop\"\n      onClick={(e) => e.target === e.currentTarget && onClose?.()}\n    >\n      <div className=\"usf-card\" onClick={(e) => e.stopPropagation()}>\n        <button className=\"usf-close\" aria-label=\"Close\" onClick={onClose}>\n          ‚úï\n        </button>\n\n        <div className=\"usf-header\">\n          <span className=\"usf-ico\">üîê</span>\n          <h3 className=\"usf-title\">Sign In</h3>\n        </div>\n\n        <form className=\"usf-form\" onSubmit={handleSubmit}>\n          <label className=\"usf-label\" htmlFor=\"login-email\">\n            Email\n          </label>\n          <input\n            id=\"login-email\"\n            className=\"usf-input\"\n            type=\"email\"\n            value={email}\n            onChange={(e) => setEmail(e.target.value)}\n            required\n          />\n\n          <label className=\"usf-label\" htmlFor=\"login-pass\">\n            Password\n          </label>\n          <input\n            id=\"login-pass\"\n            className=\"usf-input\"\n            type=\"password\"\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            required\n          />\n\n          {err && <div className=\"usf-error\">{err}</div>}\n\n          <button className=\"usf-btn usf-btn-primary\" disabled={submitting}>\n            {submitting ? \"Signing in‚Ä¶\" : \"Sign In\"}\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}